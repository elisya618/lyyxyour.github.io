<!-- 作者：戬/阿紙，禁二改本游戏 --->

<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>圣诞特辑-骆云影X你：未来的冬天还会有你吗</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background-color: #1a1a2e;
            color: white;
            height: 100vh;
            overflow: hidden;
            position: relative;
        }
         /* === 加 === */
        #loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            transition: opacity 0.5s ease;
        }
        
        #loading-overlay.hidden {
            opacity: 0;
            pointer-events: none;
        }
        
        .loading-spinner {
            width: 80px;
            height: 80px;
            border: 5px solid rgba(99, 146, 248, 0.3);
            border-top: 5px solid #6392f8;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 30px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .loading-text {
            font-size: 24px;
            margin-bottom: 15px;
            color: #6392f8;
            text-shadow: 0 0 10px rgba(99, 146, 248, 0.5);
        }
        
        .loading-subtext {
            font-size: 16px;
            color: #aaa;
            text-align: center;
            max-width: 80%;
            line-height: 1.5;
        }
        
        .loading-progress {
            width: 300px;
            height: 8px;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .loading-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #6392f8, #8ab4f8);
            border-radius: 4px;
            width: 0%;
            transition: width 0.3s ease;
        }
        
        .loading-percentage {
            font-size: 18px;
            font-weight: bold;
            color: #6392f8;
        }
        
        .loading-tip {
            position: absolute;
            bottom: 30px;
            font-size: 14px;
            color: #666;
            font-style: italic;
        }

        /* 器 */
        #game-container {
            width: 100%;
            height: 100%;
            position: relative;
            display: none; /* 初始隐藏，直到设置完名字 */
        }
        
        /* 嗯 */
        .background {
            position: absolute;
            width: 100%;
            height: 100%;
            background-image: url('https://images.unsplash.com/photo-1532274402911-5a369e4c4bb5?ixlib=rb-4.0.3&auto=format&fit=crop&w=1350&q=80');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            filter: brightness(1);
            z-index: 1;
        }
        
        /* 嗯 */
        .ui-layer {
            position: relative;
            z-index: 10;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
        }
        
 
        .top-ui {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            height: 60px;
        }
        
      
        .menu-btn {
                    position: fixed; 
            top: 20px; 
            right: 20px; 
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: rgba(0, 0, 0, 0.6);
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            z-index: 100;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
        }
        
        .menu-btn:hover {
            transform: scale(1.05);
            background-color: rgba(99, 146, 248, 0.7);
        }
        
        .menu-btn i {
            font-size: 24px;
            color: white;
        }
        
       
        .menu-modal {
            position: absolute;
            top: 70px;
            right: 20px;
            background-color: rgba(30, 30, 46, 0.95);
            border-radius: 12px;
            padding: 15px 0;
            min-width: 180px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.5);
            z-index: 200;
            display: none;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(99, 146, 248, 0.3);
        }
        
        .menu-item {
            padding: 12px 20px;
            cursor: pointer;
            transition: background-color 0.2s;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .menu-item:hover {
            background-color: rgba(99, 146, 248, 0.3);
        }
        
        .menu-item i {
            width: 20px;
            text-align: center;
        }
        
        /* 立绘区域 */
        .character-area {
            flex: 1;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: flex-end;
        }
        
        .character-img {
            max-height: 100%;
            max-width: 90%;
            object-fit: contain;
            opacity: 0;
            transition: opacity 0.8s ease;
            position: relative;
    bottom: -15%;  /* 负值向上，正值向下，这里让立绘向下突出容器15% */
        }
        
        .character-img.active {
            opacity: 1;
        }
        
        
.dialog-box {
    background: url('https://i.ibb.co/gBP4shw/1765646476569.jpg') center/cover no-repeat;
    border-radius: 20px 20px 0 0;
    padding: 25px;
    min-height: 300px;
    margin: 0 10px 0 10px;
    box-shadow: 0 -5px 20px rgba(0, 0, 0, 0.3);
    position: relative;
    z-index: 60;
}

        
       
        .speaker-name {
            position: absolute;
            top: -20px;
            left: 30px;
            background-color: rgba(99, 146, 248, 0.9);
            padding: 8px 20px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 18px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }
        
      
.dialog-text {
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
    animation: textFadeIn 0.5s ease-out 0.3s both;
    font-size: 1.06rem; 
}


@keyframes textFadeIn {
    0% {
        opacity: 0;
        transform: translateY(10px);
    }
    100% {
        opacity: 1;
        transform: translateY(0);
    }
}
        
        
        .options-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.85);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 150;
            display: none;
            padding: 20px;
        }
        
.option-title {
    animation: titlePulse 2s ease-in-out infinite;
}

@keyframes titlePulse {
    0%, 100% { text-shadow: 0 0 20px rgba(99, 146, 248, 0.8); }
    50% { text-shadow: 0 0 30px rgba(99, 146, 248, 1); }
}
        .option {
            background-color: rgba(99, 146, 248, 0.3);
            border: 2px solid rgba(99, 146, 248, 0.5);
            border-radius: 15px;
            padding: 18px 25px;
            margin: 10px 0;
            width: 90%;
            max-width: 500px;
            cursor: pointer;
            font-size: 20px;
            text-align: center;
            transition: all 0.3s;
        }
        
        .option:hover {
            background-color: rgba(99, 146, 248, 0.5);
            transform: translateY(-5px);
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.3);
        }
        

        .modal-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 300;
        }
        
        .modal-content {
            background-color: rgba(30, 30, 46, 0.95);
            border-radius: 20px;
                        padding: 30px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(99, 146, 248, 0.3);
            backdrop-filter: blur(10px);
        }
        
        .modal-title {
            font-size: 24px;
            margin-bottom: 20px;
            color: #6392f8;
            text-align: center;
        }
        
        .modal-input {
            width: 100%;
            padding: 15px;
            background-color: rgba(0, 0, 0, 0.4);
            border: 2px solid rgba(99, 146, 248, 0.5);
            border-radius: 10px;
            color: white;
            font-size: 18px;
            margin-bottom: 20px;
        }
        
        .modal-input:focus {
            outline: none;
            border-color: #6392f8;
        }
        
        .btn-group {
            display: flex;
            gap: 15px;
            justify-content: center;
        }
        
        .btn {
            padding: 12px 25px;
            border-radius: 10px;
            border: none;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
        }
        
        .btn-primary {
            background-color: #6392f8;
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #4a7df5;
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(99, 146, 248, 0.4);
        }
        
        .btn-secondary {
            background-color: rgba(255, 255, 255, 0.1);
            color: white;
        }
        
        .btn-secondary:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }

        .save-slots {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 4px;
            margin-top: 4px;
        }
        
        .save-slot {
            background-color: rgba(0, 0, 0, 0.3);
            border-radius: 4px;
            padding: 4px;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
            position: relative; 
        }
        
        .save-slot:hover {
            background-color: rgba(99, 146, 248, 0.2);
            border-color: rgba(99, 146, 248, 0.5);
        }
        
        .save-slot.active {
            border-color: #6392f8;
            background-color: rgba(99, 146, 248, 0.2);
        }
        
        .save-time {
            font-size: 14px;
            color: #aaa;
            margin-top: 5px;
        }
        
        .save-content {
            font-size: 16px;
            margin-top: 8px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .empty-slot {
            text-align: center;
            color: #888;
            font-style: italic;
            padding: 20px 0;
        }
        
       
        .save-edit-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(99, 146, 248, 0.7);
            border: none;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            transition: all 0.3s;
        }
        
        .save-edit-btn:hover {
            background: rgba(99, 146, 248, 1);
            transform: scale(1.1);
        }
       
        .save-name-edit {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .save-name-display {
            font-weight: bold;
            font-size: 16px;
            flex: 1;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .save-name-input {
            background: transparent;
            border: 1px solid rgba(99, 146, 248, 0.5);
            border-radius: 4px;
            color: white;
            padding: 4px 8px;
            font-size: 16px;
            flex: 1;
            margin-right: 5px;
        }
        
        .save-name-input:focus {
            outline: none;
            border-color: #6392f8;
        }
        
        .save-name-confirm {
            background: rgba(99, 146, 248, 0.7);
            border: none;
            border-radius: 4px;
            color: white;
            padding: 4px 8px;
            cursor: pointer;
            font-size: 12px;
        }
        
        .save-name-confirm:hover {
            background: rgba(99, 146, 248, 1);
        }
    </style>
</head>

<body>
<div id="loading-overlay">
    <div class="loading-spinner"></div>
    <div class="loading-text">马上赶来，请稍等</div>
    <div class="loading-subtext">正在加载资源，这可能需要一些时间，比较吃网速，大概是十几秒到几分钟左右，还请稍安勿躁～如果进去后还没加载好图片可以再稍微等一下～<br>请确保网络连接稳定</div>
    <div class="loading-progress">
        <div class="loading-progress-bar" id="loading-progress-bar"></div>
    </div>
    <div class="loading-percentage" id="loading-percentage">0%</div>
    <div class="loading-tip">嗯…网络良好时加载更快哦~</div>
</div>


    <div id="name-modal" class="modal-overlay">
        <div class="modal-content">
            <h2 class="modal-title">圣诞特辑-骆云影X你：未来的冬天还会有你吗</h2>
            <p style="margin-bottom: 20px; text-align: center; line-height: 1.5;">本次炒饭作者是戬（小红书名阿紙，ID：1403537996，只允许通过转发我带有此链接的小红书帖子链接用于获取本链接，如果你并没有见过那个小红书帖子还获得本链接的请告知于我来源谢谢）⭐️这是捉鬼师衍生二创短篇同人文⭐️首先严禁女主d、反作者组的人进入。❗️如果因为网速慢加载比较慢可以多等一下，有些资源会出的比较慢，第二次游览资源加载完了就会秒加载。游戏是本地储存数据的，如果清理了相关数据存档会丢失！饭只做给热爱捉鬼师的吃，作者组如觉得侵权请告知于我，我会积极配合删除相关立绘。纯代入向，故事中的你是if线，平行世界的你，接下来请输入你的名字。</p>
            <input type="text" id="player-name" class="modal-input" placeholder="欢迎你，请输入你的名字" maxlength="10">
            <div class="btn-group">
                <button id="confirm-name" class="btn btn-primary">我就叫这个名字</button>
            </div>
        </div>
    </div>

    
    <div id="game-container">
    
   
        <div class="background"></div>
        
       
        <div class="ui-layer">
            <div class="top-ui">
               
                <div id="menu-btn" class="menu-btn">
                    <i class="fas fa-bars"></i>
                </div>
                
                
                <div id="menu-modal" class="menu-modal">
                    <div id="save-btn" class="menu-item">
                        <i class="fas fa-save"></i>
                        <span>存档</span>
                    </div>
                    <div id="load-btn" class="menu-item">
                        <i class="fas fa-folder-open"></i>
                        <span>读档</span>
                    </div>
                    <div id="rename-btn" class="menu-item">
                        <i class="fas fa-user-edit"></i>
                        <span>重命名</span>
                    </div>
                </div>
            </div>
            
           
            <div class="character-area">
                
                <img id="character-img" class="character-img active" src="https://i.ibb.co/jZx222dk/1765510957321.png" alt="角色立绘">
            </div>
            
            
            <div id="dialog-box" class="dialog-box">
                <div id="speaker-name" class="speaker-name">系统</div>
                <div id="dialog-text" class="dialog-text">欢迎来到故事世界！</div>
                
            </div>
        </div>
        
    
        <div id="options-container" class="options-container">
            <h2 id="option-title" class="option-title">请根据你心里的第一直觉选择</h2>
            <div id="options-list" class="options-list">
              
            </div>
        </div>
    </div>
    
  
    <div id="save-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <h2 class="modal-title">选择存档位置</h2>
            <p style="margin-bottom: 20px; text-align: center;">选择一个位置保存当前游戏进度</p>
            <div id="save-slots" class="save-slots">
               
            </div>
            <div class="btn-group" style="margin-top: 25px;">
                <button id="confirm-save" class="btn btn-primary">确认存档</button>
                <button id="cancel-save" class="btn btn-secondary">取消</button>
            </div>
        </div>
    </div>
    

    <div id="load-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <h2 class="modal-title">选择存档读取</h2>
            <p style="margin-bottom: 20px; text-align: center;">选择一个存档加载游戏进度</p>
            <div id="load-slots" class="save-slots">
             
            </div>
            <div class="btn-group" style="margin-top: 25px;">
                <button id="confirm-load" class="btn btn-primary">确认读取</button>
                <button id="cancel-load" class="btn btn-secondary">取消</button>
            </div>
        </div>
    </div>
    
 
    <div id="rename-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <h2 class="modal-title">重命名你的名字</h2>
            <p style="margin-bottom: 20px; text-align: center;">请输入新的你的名字</p>
            <input type="text" id="new-player-name" class="modal-input" placeholder="请输入你的新名字" maxlength="10">
            <div class="btn-group">
                <button id="confirm-rename" class="btn btn-primary">确认修改</button>
                <button id="cancel-rename" class="btn btn-secondary">取消</button>
            </div>
        </div>
    </div>
    
     
    <div id="edit-save-name-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <h2 class="modal-title">编辑存档名称</h2>
            <p style="margin-bottom: 20px; text-align: center;">请输入新的存档名称</p>
            <input type="text" id="new-save-name" class="modal-input" placeholder="请输入存档名称" maxlength="20">
            <div class="btn-group">
                <button id="confirm-save-name" class="btn btn-primary">确认修改</button>
                <button id="cancel-save-name" class="btn btn-secondary">取消</button>
            </div>
        </div>
    </div>

    <script>
// === 与 ===
function preloadImages() {
    const imageUrls = new Set();
    

    Object.values(GameDialogue.dialogues).forEach(branch => {
        branch.forEach(dialogue => {
            if (dialogue.character) {
                imageUrls.add(dialogue.character);
            }

            if (dialogue.background) {
                imageUrls.add(dialogue.background);
            }
        });
    });
    
    // 添
    imageUrls.add('https://images.unsplash.com/photo-1532274402911-5a369e4c4bb5?ixlib=rb-4.0.3&auto=format&fit=crop&w=1350&q=80');
    imageUrls.add('https://raw.githubusercontent.com/elisya618/lyywenyou/main/1765636575008.jpg');
    
    const totalImages = imageUrls.size;
    let loadedImages = 0;
    
    const loadingOverlay = document.getElementById('loading-overlay');
    const loadingProgressBar = document.getElementById('loading-progress-bar');
    const loadingPercentage = document.getElementById('loading-percentage');
    
    return new Promise((resolve) => {
        if (totalImages === 0) {

            loadingProgressBar.style.width = '100%';
            loadingPercentage.textContent = '100%';
            setTimeout(() => {
                loadingOverlay.classList.add('hidden');
                setTimeout(() => {
                    document.getElementById('name-modal').style.display = 'flex';
                }, 500);
                resolve();
            }, 300);
            return;
        }
        
        const imagePromises = [];
        
        imageUrls.forEach(url => {
            const img = new Image();
            const promise = new Promise((imgResolve) => {
                img.onload = img.onerror = () => {
                    loadedImages++;
                    const progress = Math.round((loadedImages / totalImages) * 100);
                    
               
                    loadingProgressBar.style.width = progress + '%';
                    loadingPercentage.textContent = progress + '%';
                    
                    imgResolve();
                };
            });
            imagePromises.push(promise);
            img.src = url;
        });
        
   
        Promise.all(imagePromises).then(() => {
            setTimeout(() => {
                loadingOverlay.classList.add('hidden');
                setTimeout(() => {
                    document.getElementById('name-modal').style.display = 'flex';
                }, 500);
                resolve();
            }, 300);
        });
    });
}

document.addEventListener("DOMContentLoaded", async () => {
    await preloadImages();
    initGame();
});

      
        const GameData = {
           
            playerName: "捉鬼师",
            
          
            currentState: {
                dialogueIndex: 0, 
                branch: "start",  
                characterVisible: true, 
                backgroundImage: "https://i.ibb.co/kV3qHPyJ/IMG-20251212-220649.png" ,
                currentBackground: "https://i.ibb.co/Gf67fn0d/IMG-20251213-200004.png",
            },
            
            
            saveSlots: new Array(10).fill(null),
            
            
            initSaves: function() {
                const saves = localStorage.getItem("dialogueGameSaves");
                if (saves) {
                    this.saveSlots = JSON.parse(saves);
                }
            },
            
  
            saveToSlot: function(slotIndex, saveName = null) {
                if (slotIndex >= 0 && slotIndex < this.saveSlots.length) {
                    const saveData = {
                        playerName: this.playerName,
                        state: {...this.currentState},
                        timestamp: new Date().toLocaleString(),
                        saveName: saveName || `存档位 ${slotIndex + 1}`
                    };
                    
                    this.saveSlots[slotIndex] = saveData;
                    localStorage.setItem("dialogueGameSaves", JSON.stringify(this.saveSlots));
                    return true;
                }
                return false;
            },
            
          
 
            loadFromSlot: function(slotIndex) {
                if (slotIndex >= 0 && slotIndex < this.saveSlots.length && this.saveSlots[slotIndex]) {
                    const saveData = this.saveSlots[slotIndex];
                    this.playerName = saveData.playerName;
                    this.currentState = {...saveData.state};
                    return true;
                }
                return false;
            },
            
  
            renameSaveSlot: function(slotIndex, newSaveName) {
                if (slotIndex >= 0 && slotIndex < this.saveSlots.length && this.saveSlots[slotIndex]) {
                    this.saveSlots[slotIndex].saveName = newSaveName;
                    localStorage.setItem("dialogueGameSaves", JSON.stringify(this.saveSlots));
                    return true;
                }
                return false;
            }
        };
        
  
        const GameDialogue = {
            dialogues: {
                start: [
                    { 
                        background:"https://i.ibb.co/6RtvsBRL/IMG-20251213-200004.png",
                        speaker: "游玩须知", 
                        text: "此地是骆云影的专场，刀子预警，有刀：骆云影x你：未来的冬天还会有你吗\n✨ooc致歉让你不舒服致歉一切，改图致歉，立绘图片来源于捉鬼师官图作者sad，人物设定来源于王猪。不许盈利、二改游戏。希望能在原发布帖子里得到游玩反馈，谢谢～", 
                        character: null, // 系统消息没有立绘
                        options: null // 没有选项
                    },
                    { 
                        speaker: "游玩须知", 
                        text: "图片使用官游立绘我二改/二抠的，无偿供大家游玩，图片版权仍属于官方。全局使用“你”的视角，因此对骆云影描述会很少，本游戏可存档读档，根据需要自行使用，存档旁的蓝色按钮可改存档名，重刷新页面可回到最开始页面，预祝游玩愉快。", 
                        character: null,
                        options: null
                    },
                    { 
                        text: "你是一名初级捉鬼师，有时候你勤勤恳恳下班了，一旦接到委托你就会去做，用于增添一些收入。", 
                        character: null,
                        options: null
                    },
                    { 
                    background:"https://i.ibb.co/0ynZM9fj/IMG-20251213-200955.png",
                        text: "某一天你路过一个废弃工厂，有个人想你寻求帮助，她和你说她的朋友在里面探险很久都没出来，你选择：",
                        character: null,
                        options: null
                    },
                    { 
                    text: "让我想想…",
                        character: null,
                        options: [
                            { text: "不帮助她", nextBranch: "不帮助她" },
                            { text: "帮助她", nextBranch: "帮助她" },
                        ]
                    }
                ],
                

                不帮助她: [
                    { 
                    background:"https://i.ibb.co/kV3qHPyJ/IMG-20251212-220649.png",
                        text: "你礼貌选择了拒绝，表示很抱歉，但是自己还有事，很遗憾帮不了她，让她寻求他人帮忙。", 
                        character: null,
                        options: null
                    },
                    { 
                        text: "END.（达成结局1——无事发生）（点击继续重新开始，想打其他结局也可以读档重来）", 
                        character: null,
                    }
                ],
                
             
                帮助她: [
                    { 
                        background:"https://i.ibb.co/kV3qHPyJ/IMG-20251212-220649.png",
                        text: "你告诉她别怕，你有相关经验，可以进去工厂帮助她。她激动的和你连连道谢，不停的和你鞠躬，然后把你带到了她朋友进去的工厂门口。", 
                        character: null,
                        options: null
                    },
                    { 
                    background:"https://i.ibb.co/5xfgwk62/IMG-20251213-200955.png",
                        text: "你找了进去，摸索了很久，找到了一只鬼。你发现那不是一只普通的怨鬼，而是一只几乎已经进化出实体的接近厉鬼的怨鬼了。以你的能力还是不够打的，你想跑但已经晚了，因为你被发现了。", 
                        character: null,
                    },
                    { 
                    text: "你殊死一搏发现你的符纸砸在怨鬼身上跟挠痒痒没区别，在你以为自己要死在那里的时候，一道银白色的锁魂链破空而来，将厉鬼钉在了墙上。",
                        character: null,
                        options: null
                    },
                    { 
                    text: "一个身高较高的漂亮男人从阴影中走出来，身上穿着黑色的短夹克，凌乱的黑发，开着阴阳眼的鎏金色眸子里不起一丝波澜。",
                        character: "https://i.ibb.co/jZx222dk/1765510957321.png",
                        options:null
                    },
                    { 
                        speaker: "？？", 
                        text: "他看着你，嘴角勾起冷哼了一声，", 
                        character: "https://i.ibb.co/jZx222dk/1765510957321.png",
                        },
                        { 
                        speaker: "？？", 
                        text: "“呵，就一个菜鸟还敢来找快成型的鬼打架，我该说你胆子大呢还是说你蠢呢？”", 
                        character: "https://i.ibb.co/pBVMrvz7/1765510934214.png",
                        },
                        { 
                        text: "他嘲讽完你，就去把鬼按在墙上一顿暴揍，手法堪称暴力美学，你惊奇的看着这个碾压式捉鬼手法，虽然残暴但是却很有观赏性（？。", 
                        character:null,
                        },
                        { 
                        speaker: "？？", 
                        text: "鬼消散以后他看也不看你一眼就离开了，你甚至没机会和他说一声“谢谢”。", 
                        character: "https://i.ibb.co/gFX0md9t/1765510873181.png",
                        },
                        { 
                        text: "随着脚步声远去，你因极度紧张而砰砰乱跳的心脏终于开始逐渐平稳起来。你稍作休息就继续深入找到了那个被吓晕在工厂某一处的探险者并把他带了出来。", 
                        character:null,
                        },
                        { 
                        text: "你在被救的探险者的千恩万谢中回了家，到家后你还在想着这件事，你决定第二天——", 
                        },
                        {
                        text:"…",
                        character:null,
                        options: [
                            { text: "在心里默默感谢他", nextBranch: "温暖" },
                            { text: "去寻找他的联系去给他送个礼物作为谢礼", nextBranch: "遇见月亮" },
                        ]
                    }
                ],
                        
                
               
                温暖: [
                    { 
                        background:"https://i.ibb.co/6RtvsBRL/IMG-20251213-200004.png",
                        text: "你在心里感谢这个无名的好心人，这件事也成为了你努力变强的原因，因此你也在未来帮助了更多人。", 
                        character:null,
                        options: null
                    },
                    {
                        text: "END.（达成结局2——这个温暖的接力棒我来传递！）（点击继续重新开始，想打其他结局也可以读档重来）", 
                    }
                ],
                
               
                遇见月亮: [
                    {
                        background:"https://i.ibb.co/Gf67fn0d/IMG-20251213-200004.png",
                        text: "你去多方打听，却发现一无所获，最后在一次机缘巧合之下有个叫汤嘉维的告诉了你他的信息，他叫骆云影，你发现他喜欢吃奶油小方，于是你排了老长的队买了个奶油小方，然后你们莫名其妙地开始了频繁接触。", 
                        options: null
                    },
                    { 
                        text: "后来你才知道原来当天他是接了家族委托来处理那只鬼，你也是运气好正好撞到他来处理委托才捡回一条小命。后来你们莫名其妙的就开始渐渐熟络了，甚至后来还总是一起出任务，一起吃饭。", 
                        character: null,
                        options: null,
                        },
                        { 
                        text: "他心情不好的时候你会安慰他，你心情不好的时候他也会带你去看星星，久而久之你也习惯了和他一起看星星。", 
                        character: null,
                        options: null,
                        },
                        { 
                        background:"https://i.ibb.co/6J754DmC/IMG-20251213-231727.png",
                        text: "这天你心情不大好，骆云影依旧选择带你一起看星星。", 
                        character: null,
                        options: null,
                        },
                        { 
                        text: "你和他一起坐着看了很久星星，你突然开口，", 
                        character: null,
                        options: null,
                        },
                        { 
                        speaker: "{PLAYER_NAME}",
                        text: "“这个星星还是这么好看。”", 
                        character: null,
                        options: null,
                    },
                    { 
                        speaker: "骆云影",
                        text: "“嗯。只有来这里看星星我的心里才能感到前所未有的平静。”", 
                        character: "https://i.ibb.co/Jj3mqNKn/1765545948568.png",
                        options: null,
                    },
                    {
                        text: "你沉默着看了他一眼，或许他有很多你不知道的秘密吧，才会想来这个天台上暂时放下尘世的喧嚣。", 
                        options: null,
                    },
                    { 
                        text: "你突然想起了什么，没头没脑的问了一句：", 
                        character: null,
                        options: null,
                    },
                     { 
                        speaker: "{PLAYER_NAME}",
                        text: "“那你为什么要带着我一起来呢。”", 
                        options: null,
                    },
                     { 
                     character:"https://i.ibb.co/MxDJMsyX/1765991708888.png",
                        speaker: "骆云影",
                        text: "…", 
                        options: null,
                    },
                    { 
                        speaker: "骆云影",
                        text: "“哈？你不是也心情也不好吗。”", 
                        character: "https://i.ibb.co/JWjGPYg9/1765901340123.png",
                        options: null,
                        },
                        { 
                        text: "心情不好？或许是吧。你的心跳莫名漏跳了一拍。", 
                        character: null,
                        options: null,
                        },
                        { 
                        text: "你突然想逗逗他，于是你也扭头，说道：", 
                        options: null,
                        },
                        { 
                        speaker: "{PLAYER_NAME}",
                        text: "“你啊，没想到还挺有品味的。那我真是很荣幸了，此时能有机会陪在你身边。”", 
                        options: null,
                        },
                        { 
                        text: "空气突然安静了一秒。", 
                        options: null,
                        },
                        { 
                        character: "https://i.ibb.co/b8hT3PM/1765905295629.png",
                        speaker: "骆云影",
                        text: "“…”", 
                        options: null,
                        },
                        { 
                        speaker: "骆云影",
                        text: "“算你有点眼光。”", 
                        character: "https://i.ibb.co/WWdrTkk2/1765904310095.png",
                        options: null,
                        },
                        { 
                        text: "…", 
                        options: null,
                        },
                        {
                        background:"https://i.ibb.co/6RtvsBRL/IMG-20251213-200004.png",
                        text: "自那天后，说实话，时间久了你也会渐渐对他产生感情，但你也不知道从哪天开始对他竟产生了期待，暗地里希望能有一天能名正言顺站在他身边行使正牌女友的权利。", 
                        options: null,
                        },
                        {
                        text: "但你们的关系也卡在友谊之上恋人未满的地方，而且第一年后半年就开始卡，卡了快三年了。", 
                        options: null,
                        },
                        {
                        text: "你每晚睡觉前都在猜测他是不是对你没感觉，即使会和你一起出任务，有时候也会照顾你给你买你喜欢吃的东西，但是会说“啧，买多了，放着也会坏，给你吧”，但你觉得这也可能是只觉得你是个听话不拖后腿的好队友所以赏了点“特殊奖励”给你罢了。", 
                        options: null,
                        },
                        {
                        text: "但是你心底里却不甘愿只是这样，可你也没办法，毕竟看他这样你说了可能连朋友都做不成了，你也担心听到心里最不想听到的话，只能把心意藏于心底，继续和他做明面上的“朋友/好队友”。", 
                        options: null,
                        },
                        {
                        text: "…", 
                        options: null,
                        },
                        {
                        background:"https://i.ibb.co/ccp4bcnt/IMG-20251218-004337.png",
                        text: "时间过得很快，一晃就是三年后了，此时正值冬季，十二月的街头挂满了圣诞装饰——因为圣诞节快到了，橱窗里闪烁着暖黄色的灯光，空气中飘着烤栗子的香气。", 
                        options: null,
                        },
                        {
                        background:"https://i.ibb.co/GvDwGY6D/IMG-20251218-000514.png",
                        text: "你坐在咖啡厅的落地窗旁的位置上，手里捧着已经凉了一半的美式咖啡。你盯着手机屏幕上骆云影发来的消息：一个简短的“嗯”。", 
                        options: null,
                        },
                        {
                        text: "你看着屏幕上简简单单的一个字，眼中平静无波。", 
                        options: null,
                        },
                        {
                        character:"https://i.ibb.co/xKpm48M0/1766069730176.png",
                        speaker: "服务员小姐",
                        text: "“小姐，您的黑森林蛋糕。”服务员将精致的甜品放在你面前。", 
                        options: null,
                        },
                        {
                        text: "这是骆云影特地为你订的限量款，连续三年他订的蛋糕都是这个味道，平时也会大老远跑去带其他你喜欢的零食给你，有时候你不在家他还会挂在门把手上。", 
                        options: null,
                        },
                        {
                        text: "你又回忆起他带你去天台看星星的经历。", 
                        options: null,
                        },
                        {
                        text: "感觉好累，一直在猜…所以这算什么？", 
                        options: null,
                        },
                        {
                        text: "要不还是别自作多情了，人家只是觉得对朋友好点也没问题，你一直在胡思乱想的猜了三年，你在今年立春的时候也探过口风，你问他对你他什么感觉，他也只是随口回答了句不知道，最后没下文了，因此你也不敢过多追问，所以你觉得这样也有点太影响你生活了。", 
                        options: null,
                        },
                        {
                        text: "要不…做个了断吧，世界上的男生这么多没必要一直吊死在这里。", 
                        options: null,
                        },
                        {
                        text: "念头生成，你放下叉子，从包里掏出手机。", 
                        options: null,
                        },
                        {
                        text: "那是上个月你在网上早就看到的，一对情侣在圣诞树下拍的视频——男生穿着风衣站在圣诞树下，张开双臂，女生从远处跑过来扑进他怀里。", 
                        options: null,
                        },
                        {
                        text: "你一直都觉得这个视频有点太暧昧了，毕竟你缺少一个光明正大和他要求这个的身份，一个权利，你盯着那视频看了很久，心里出现一个念头。", 
                        options: null,
                        },
                        {
                        text: "你决定第一次开口请求他拍一个同款视频，作为这三年暗恋的结束，然后远离他或许会更好点。", 
                        options: null,
                        },
                        {
                        text: "你觉得他同意了最好，不同意就当没有也行了。", 
                        options: null,
                        },
                        {
                        text: "反正你已经不想和他这样不明不白的了，这样纯折磨自己，每天猜猜猜猜的你都感觉心力交瘁了，因为暗恋一个人他的一举一动都在影响着你的情绪，你已经受够了，虽然他也没什么错吧，但是你觉得这样就是不好。", 
                        options: null,
                        },
                        {
                        background:"https://i.ibb.co/Gf67fn0d/IMG-20251213-200004.png",
                        text: "你跟公司申请了调到另一个较远的城市分部工作，由于你平时很努力工作，因此这个申请很快获得了审批。", 
                        options: null,
                        },
                        {
                        text: "…", 
                        options: null,
                        },
                        {
                        background:"https://i.ibb.co/27PSyG0z/IMG-20251218-230858.png",
                        text: "多日后的圣诞，夜幕降临，A市中心广场的圣诞树亮起了彩灯，人群熙熙攘攘。", 
                        options: null,
                        },
                        {
                        text: "你站在圣诞树前，深吸了一口气，给骆云影发了条消息：“今晚有空吗？中心广场见。”", 
                        options: null,
                        },
                        {
                        character:"https://i.ibb.co/69SCRhq/1766508276386.png",
                        text: "过了十分钟，骆云影回复：“嗯。”", 
                        options: null,
                        },
                        {
                        text: "你没想到他这么快就同意了，心里很快就小小的欣喜了一下，还是可以留下纪念的嘛。不过这份短暂的欣喜很快就被即将到来的离别的酸涩淹没了。", 
                        options: null,
                        },
                        {
                        text: "…", 
                        options: null,
                        },
                        {
                        character:"https://i.ibb.co/MxDJMsyX/1765991708888.png",
                        text: "你站在圣诞树前等他。晚上八点，骆云影准时出现了。他的黑发随意的披散在肩头，那标志性的漂亮脸蛋吸引了不少沿路女孩的视线。你上前，犹豫了一下，", 
                        options: null,
                        },
                        {
                        speaker: "{PLAYER_NAME}",
                        text: "“骆云影，我想拍个视频。”", 
                        options: null,
                        },
                        {
                        speaker: "骆云影",
                        character:"https://i.ibb.co/JWjGPYg9/1765901340123.png",
                        text: "“拍什么？”", 
                        options: null,
                        },
                        {
                        speaker: "骆云影",
                        character:"https://i.ibb.co/JRcgvdhX/1765903572556.png",
                        text: "“不会是想让我扮演圣诞老人吧？”", 
                        options: null,
                        },
                        {
                        speaker: "{PLAYER_NAME}",
                        text: "“是圣诞主题，但不是让你扮演这个。”你指了指身后的圣诞树，“你站在树下，张开双臂，我从那边跑过来扑进你怀里。就这样。”", 
                        options: null,
                        },
                        {
                        character:"https://i.ibb.co/LXkvXLFh/1765901433483.png",
                        text: "骆云影盯着你看了几秒，", 
                        options: null,
                        },
                        {
                        speaker: "骆云影",
                        character:"https://i.ibb.co/JWjGPYg9/1765901340123.png",
                        text: "“你拍这种无聊的东西干什么？”", 
                        options: null,
                        },
                        {
                        text: "你的心一沉。你知道他会这么说，因为他向来觉得这种浪漫的事情很幼稚。", 
                        options: null,
                        },
                        {
                        speaker: "{PLAYER_NAME}",
                        text: "“就一次，拍完这次我要去其他城市了。”", 
                        options: null,
                        },
                        {
                        text: "空气突然安静了几秒。", 
                        options: null,
                        },
                        {
                        speaker: "骆云影",
                        character:"https://i.ibb.co/JWjGPYg9/1765901340123.png",
                        text: "“哈？”", 
                        options: null,
                        },
                        {
                        speaker: "骆云影",
                        character:"https://i.ibb.co/JWjGPYg9/1765901340123.png",
                        text: "“你去这么远的地方干什么？”", 
                        options: null,
                        },
                        {
                        speaker: "{PLAYER_NAME}",
                        text: "“工作调动。”你随口编了句。", 
                        options: null,
                        },
                        {
                        character:"https://i.ibb.co/LXkvXLFh/1765901433483.png",
                        text: "骆云影的神色没什么变化，但眼神最深处闪过了一丝复杂的情绪。", 
                        options: null,
                        },
                        {
                        speaker: "骆云影",
                        character:"https://i.ibb.co/JWjGPYg9/1765901340123.png",
                        text: "“必须要去吗？”", 
                        options: null,
                        },
                        {
                        speaker: "{PLAYER_NAME}",
                        text: "“嗯，必须要去。”", 
                        options: null,
                        },
                        {
                        text: "他沉默了一会，抬手揉了揉头发。", 
                        options: null,
                        },
                        {
                        speaker: "骆云影",
                        character:"https://i.ibb.co/JWjGPYg9/1765901340123.png",
                        text: "“啧，拍吧。”", 
                        options: null,
                        },
                        {
                        text: "你愣了愣，你以为他会拒绝，或者至少多问几句。但他只是答应了，像答应一件微不足道的小事一样。", 
                        options: null,
                        },
                        {
                        text: "你架好手机，走到离圣诞树十米远的地方。骆云影站在圣诞树下，身影在彩灯的映照下显得格外孤独。", 
                        options: null,
                        },
                        {
                        text: "“准备好了吗？”你喊道。", 
                        options: null,
                        },
                        {
                        speaker: "骆云影",
                        character:"https://i.ibb.co/MxDJMsyX/1765991708888.png",
                        text: "“嗯。”", 
                        options: null,
                        },
                        {
                        speaker: "{PLAYER_NAME}",
                        text: "“张开手臂。”", 
                        options: null,
                        },
                        {
                        character:"https://i.ibb.co/LXkvXLFh/1765901433483.png",
                        text: "骆云影犹豫了一下，还是张开了双臂。彩灯在他身后闪烁，他的脸上没有任何表情，只是淡淡地看着你，只是今天他看向你的眼神格外复杂。", 
                        options: null,
                        },
                        {
                        text: "你来不及多想，按下录制键，深吸一口气，朝他跑过去。", 
                        options: null,
                        },
                        {
                        text: "十米的距离，你心里想着要是这个瞬间再久一点就好了，拉得再长一点这样你就可以多看他几秒了。", 
                        options: null,
                        },
                        {
                        text: "你扑进他怀里的时候，骆云影的手臂环住了你。他的体温很高,隔着厚厚的高领毛衣都能感受到。你闭上眼睛，用力记住这个拥抱——这是你三年来第一次主动要求的拥抱，也是最后一次。", 
                        options: null,
                        },
                        {
                        speaker: "骆云影",
                        character:"https://i.ibb.co/JWjGPYg9/1765901340123.png",
                        text: "“拍完了？”", 
                        options: null,
                        },
                        {
                        speaker: "{PLAYER_NAME}",
                        text: "“嗯。”你说道。", 
                        options: null,
                        },
                        {
                        text: "他松开了手。", 
                        options: null,
                        },
                        {
                        text: "你退开一步，走回去捡起手机。视频里，你扑进他怀里的瞬间，他的手臂环住了你，动作自然得你们俩像做过无数次一样。", 
                        options: null,
                        },
                        {
                        speaker: "{PLAYER_NAME}",
                        text: "你保存了视频，抬起头，“谢谢你。”", 
                        options: null,
                        },
                        {
                        speaker: "骆云影",
                        character:"https://i.ibb.co/JWjGPYg9/1765901340123.png",
                        text: "“嗯。”骆云影把手插进口袋，“回去了？”", 
                        options: null,
                        },
                        {
                        speaker: "{PLAYER_NAME}",
                        text: "“你先回吧。”你笑了笑，“我还想在这里待一会。”", 
                        options: null,
                        },
                                                {
                        speaker: "骆云影",
                        character:"https://i.ibb.co/JWjGPYg9/1765901340123.png",
                        text: "骆云影盯着你看了几秒，“一个人不安全。”", 
                        options: null,
                        },
                        {
                        speaker: "{PLAYER_NAME}",
                        text: "“没事，我是捉鬼师，能保护自己。”", 
                        options: null,
                        },
                        {
                        speaker: "骆云影",
                        character:"https://i.ibb.co/JWjGPYg9/1765901340123.png",
                        text: "“啧，那你一个人小心点。”他皱了皱眉，但还是转身离开了。", 
                        options: null,
                        },
                        {
                        text: "你看着他的背影消失在人群中，突然觉得胸口一阵发紧。", 
                        options: null,
                        },
                        {
                        text: "…",
                        options: [
                            { text: "留一张便签条在树洞里当告别", nextBranch: "时空交错" },
                            { text: "直接离开", nextBranch: "记忆里的人" },
                        ]
                        }
                ],
                
               
                记忆里的人:[
                    { 
                        text: "你深吸一口气，看了一会圣诞树和周围充满了快乐感染力的人群，可此时的你却感觉不到一丝愉悦。", 
                        character: null,
                        options: null
                    },
                    { 
                    background:"https://i.ibb.co/6RtvsBRL/IMG-20251213-200004.png",
                        text: "你当晚就搬去了新城市，开始了新的生活。虽然一开始还经常想到骆云影，经常在深夜一遍又一遍的看那个冬夜拍的视频一边看一边落泪，但到了后来你也慢慢习惯了，开始全身心投入工作和捉鬼两点一线里，也减少了去想这个的频率。", 
                        character: null,
                        options: null
                    },
                    {
                        text: "嗯，生活还得继续，不是吗？", 
                        options: null,
                        },
                        {
                        text: "END.（达成结局3：冬日的遗憾）（点击继续重新开始，想打其他结局也可以读档重来）", 
                        options: null,
                        }
                ],
                
                //时空交错
                时空交错:[
                    { 
                        text: "你深吸了一口气，从包里掏出一张便签纸，在上面写了几行字，然后走到圣诞树下，将便签塞进了树洞里。", 
                        character: null,
                        options: null
                    },
                    { 
                        text: "你知道骆云影不会来找这张便签。他不是那种会做浪漫事情的人。", 
                        character: null,
                        options: null
                    },
                    {
                        text: "但你还是写了。", 
                        options: null,
                        },
                    {
                        text: "便签上只有一句话：“三年了,我等累了。再见，骆云影。”", 
                        options: null,
                        },
                    {
                        background:"https://i.ibb.co/6RtvsBRL/IMG-20251213-200004.png",
                        text: "你当晚就搬去了新城市，开始了新的生活。虽然一开始还经常想到骆云影，经常在深夜一遍又一遍的看那个冬夜拍的视频一边看一边落泪，但到了后来你也慢慢习惯了，开始全身心投入工作和捉鬼两点一线里，也减少了去想这个的频率。", 
                        options: null,
                        },
                    {
                    character:"https://i.ibb.co/TDCQTjwx/1766507351360.png",
                        text: "就这样到了五年后的圣诞节,你收到了骆云影的消息。", 
                        options: null,
                        },
                    {
                        text: "沉思中…", 
                        options: [
                        { text: "去", nextBranch: "未尽的缘分" },
                            { text: "不去", nextBranch: "定格的拥抱" },
                            ]
                        }
                ],
                
                定格的拥抱:[
                    { 
                        text: "你拒绝了他，一个蛋糕有什么值得你舟车劳顿的，况且你已经坚定要这样做了，没必要回去再影响自己的心情。之后你的工作也很顺利，安安稳稳的过着自己的日子，只是偶尔晚上总会想起他，你总会在这时叹口气，然后继续做自己的事情。", 
                        character: null,
                        options: null
                    },
                    { 
                        text: "END.（达成结局4：定格的拥抱）（点击继续重新开始，想打其他结局也可以读档重来）", 
                        character: null,
                        options: null
                    }
                ],
                
                未尽的缘分:[
                    {
                        background:"https://i.ibb.co/6RtvsBRL/IMG-20251213-200004.png",
                        text: "面对他的邀请，你实在是无法拒绝他，因为你从未曾放下过。最后你选择回去了，你在沿途的车上看着快速掠过的风景，感叹时间过得很快，转眼间又五年了，不知道…他怎么样了。", 
                        character: null,
                        options: null
                    },
                    { 
                    background:"https://i.ibb.co/27PSyG0z/IMG-20251218-230858.png",
                        text: "晚上，广场上的圣诞树依旧像五年前那样闪烁着彩灯。", 
                        character: null,
                        options: null
                    },
                    {
                        character:"https://i.ibb.co/MxDJMsyX/1765991708888.png",
                        text: "骆云影站在圣诞树下，手里捏着一张泛黄的便签纸，看着周围娱乐的孩童，思绪飘远。", 
                        options: null,
                        },
                        {
                        text: "其实你离开以后，他发现和你没了共同话题，即使有网上联系也说不了几句，这让他感觉心里空落落，似乎感觉少了点什么，时间过得越长，这种感受越明显。", 
                        options: null,
                        },
                        {
                        text: "一开始他还会发消息：“吃饭没。”你回“吃了”，他回“嗯”，然后就没有然后了。", 
                        options: null,
                        },
                        {
                        text: "他不知道该说什么。问工作？你换了新环境，接的委托他不了解。问生活？你在隔壁城市认识了新朋友，那些人他连名字都没听过。问近况？你说一切都好，语气礼貌得像在应付一个不值一提的普通朋友。", 
                        options: null,
                        },
                        {
                        text: "他们的聊天记录越来越短，从一天几条变成三天一条，再变成一周一条，最后变成只有节日才会出现的那句“节日快乐”。", 
                        options: null,
                        },
                        {
                        text: "骆云影发现，他甚至不知道该在什么时候打开和你的对话框。", 
                        options: null,
                        },
                        {
                        text: "以前不是这样的。", 
                        options: null,
                        },
                        {
                        text: "以前你在的时候，他不需要找话题。你会叽叽喳喳地说今天遇到了什么鬼，吃了什么好吃的，看了什么烂剧。他只需要听着，偶尔回一句“嗯”或者“啧”，你就能自己把天聊下去。", 
                        options: null,
                        },
                        {
                        text: "他从来不觉得那些话有什么意义，甚至有时候会觉得吵。", 
                        options: null,
                        },
                        {
                        text: "但现在他的世界安静了，安静得让他觉得耳朵里嗡嗡作响。", 
                        options: null,
                        },
                        {
                        text: "今年是你离开的第五年，昨天不知怎么的，他鬼使神差就想来这里看看，视线扫过当年和你一起拍视频的圣诞树，发现上面有个树洞，他就伸手随便抓了一把随便看看，看见了不少人留下的对未来美好的期待，他就这样看了一张又一张。", 
                        options: null,
                        },
                        {
                        text: "就在此时，突然看到了其中一张发黄的便签纸——很明显写下这张便签的时间已经很久了。上面只有短短一句话：", 
                        options: null,
                        },
                        {
                        text: "“三年了,我等累了。再见,骆云影。”", 
                        options: null,
                        },
                        {
                        text: "他盯着那行字看了很久。", 
                        options: null,
                        },
                        {
                        text: "广场上的圣诞歌还在循环播放,情侣们在圣诞树下拍照,笑声此起彼伏。", 
                        options: null,
                        },
                        {
                        character:"https://i.ibb.co/MxDJMsyX/1765991708888.png",
                        text: "思绪回归，他拿起便签纸展开继续看。", 
                        options: null,
                        },
                        {
                        character:"https://i.ibb.co/LXkvXLFh/1765901433483.png",
                        text: "他看完后抬起头，看见了熟悉的身影。", 
                        options: null,
                        },
                        {
                        speaker: "骆云影",
                        character:"https://i.ibb.co/JWjGPYg9/1765901340123.png",
                        text: "是你。", 
                        options: null,
                        },
                        {
                        character:"https://i.ibb.co/LXkvXLFh/1765901433483.png",
                        text: "四目相对的瞬间，广场的喧嚣仿佛被按下了静音键，骆云影的手瞬间攥紧了便签纸。", 
                        options: null,
                        },
                        {
                        speaker: "{PLAYER_NAME}",
                        text: "“好久不见。”你的声音很轻，被喧嚣的圣诞歌撞得有些碎，却清晰地进他的耳朵。", 
                        options: null,
                        },
                        {
                        character:"https://i.ibb.co/LXkvXLFh/1765901433483.png",
                        text: "他没有把手里的便签藏起来，也没有迈步上前。", 
                        options: null,
                        },
                        {
                        character:"https://i.ibb.co/LXkvXLFh/1765901433483.png",
                        text: "两人之间隔着熙攘的人群，隔着五年的空白，隔着无数次没有发送的消息和深夜独自看过的星星。", 
                        options: null,
                        },
                        {
                        text: "雪花开始飘落，落在你的发梢，也落在他的肩头。", 
                        options: null,
                        },
                        {
                        text: "这一次，没有人转身离开，也没有人扑进怀里。你们只是站在那里，任由漫长的时光在这一刻折叠、重合。骆云影回过神来，压下了眼中翻涌的情绪，", 
                        options: null,
                        },
                        {
                        character:"https://i.ibb.co/JWjGPYg9/1765901340123.png",
                        text: "“嗯，好久不见。”", 
                        options: null,
                        },
                        {
                        text: "雪越下越大，但好像这次没有再影响到谁的心境了。", 
                        options: null,
                        },
                        {
                        text: "…", 
                        options: null,
                        },
                        {
                        text: "(达成结局5——终章，还是序曲？）（点击继续重新开始，想打其他结局也可以读档重来）", 
                        }
                ],
                

                

                game_end:[
                    { 
                        text: "…", 
                        character: null,
                        options: null
                    }
                ]
            },
            

            getCurrentDialogue: function() {
                const branch = GameData.currentState.branch;
                const index = GameData.currentState.dialogueIndex;
                
                if (this.dialogues[branch] && index < this.dialogues[branch].length) {
                    return this.dialogues[branch][index];
                }
                return null;
            },
            

            nextDialogue: function() {
                const branch = GameData.currentState.branch;
                const index = GameData.currentState.dialogueIndex;

                const current = this.getCurrentDialogue();
                if (current && current.options) {
                    return false;
                }
                
    
                if (this.dialogues[branch] && index + 1 < this.dialogues[branch].length) {
                    GameData.currentState.dialogueIndex++;
                    return true;
                } else {
                    if (branch === "game_end" || branch.startsWith("dragon_") || branch.startsWith("puzzle_") || branch === "help_despite_fear" || branch === "leave_danger") {
                        GameData.currentState.branch = "game_end";
                        GameData.currentState.dialogueIndex = 0;
                        return true;
                    }
                    return false;
                }
            },
            
          
            selectOption: function(optionIndex) {
                const current = this.getCurrentDialogue();
                if (current && current.options && optionIndex < current.options.length) {
                    const selectedOption = current.options[optionIndex];
                    
                  
                    GameData.currentState.branch = selectedOption.nextBranch;
                    GameData.currentState.dialogueIndex = 0;
                    
                    return true;
                }
                return false;
            }
        };
        
         // DOM元素引用
        const domElements = {
           
            nameModal: document.getElementById("name-modal"),
            gameContainer: document.getElementById("game-container"),
            
           
            menuBtn: document.getElementById("menu-btn"),
            menuModal: document.getElementById("menu-modal"),
            saveBtn: document.getElementById("save-btn"),
            loadBtn: document.getElementById("load-btn"),
            renameBtn: document.getElementById("rename-btn"),
            
            
            saveModal: document.getElementById("save-modal"),
            loadModal: document.getElementById("load-modal"),
            renameModal: document.getElementById("rename-modal"),
            
           
            speakerName: document.getElementById("speaker-name"),
            dialogText: document.getElementById("dialog-text"),
            dialogBox: document.getElementById("dialog-box"),
            characterImg: document.getElementById("character-img"),
            
 
            optionsContainer: document.getElementById("options-container"),
            optionsList: document.getElementById("options-list"),
            optionTitle: document.getElementById("option-title"),
           
          
            editSaveNameModal: document.getElementById("edit-save-name-modal"),
            newSaveNameInput: document.getElementById("new-save-name"),
            confirmSaveNameBtn: document.getElementById("confirm-save-name"),
            cancelSaveNameBtn: document.getElementById("cancel-save-name")
        };
        
    
        let selectedSaveSlot = -1;
        let editingSaveSlot = -1;

 
        
     
        function initGame() {
        
        
document.querySelector('.background').style.backgroundImage = `url('${GameData.currentState.currentBackground}')`;

         
            GameData.initSaves();
            
 
            const playerNameInput = document.getElementById("player-name");
            const confirmNameBtn = document.getElementById("confirm-name");
            

            confirmNameBtn.addEventListener("click", () => {
                const name = playerNameInput.value.trim();
                if (name) {
                    GameData.playerName = name;
                    domElements.nameModal.style.display = "none";
                    domElements.gameContainer.style.display = "block";
                    updateDialogue();
                } else {
                    alert("请输入你的名字！");
                }
            });
            
              // 回车键确认名字
            playerNameInput.addEventListener("keypress", (e) => {
                if (e.key === "Enter") {
                    confirmNameBtn.click();
                }
            });
            
            // 菜单按钮事件
            domElements.menuBtn.addEventListener("click", () => {
                const isVisible = domElements.menuModal.style.display === "block";
                domElements.menuModal.style.display = isVisible ? "none" : "block";
            });
            
            // 存档按钮事件
            domElements.saveBtn.addEventListener("click", () => {
                domElements.menuModal.style.display = "none";
                showSaveModal();
            });
            
            // 读档按钮事件
            domElements.loadBtn.addEventListener("click", () => {
                domElements.menuModal.style.display = "none";
                showLoadModal();
            });
            
            // 重命名按钮事件
            domElements.renameBtn.addEventListener("click", () => {
                domElements.menuModal.style.display = "none";
                showRenameModal();
            });
            
            // 对话框点击事件（点击继续）
            domElements.dialogBox.addEventListener("click", () => {
                // 如果选项界面显示中，不响应点击
                if (domElements.optionsContainer.style.display === "flex") {
                    return;
                }
                
                // 前进到下一句对话
                if (GameDialogue.nextDialogue()) {
                    updateDialogue();
                } else {
                    // 如果没有更多对话，重新开始游戏
                    GameData.currentState.branch = "start";
                    GameData.currentState.dialogueIndex = 0;
                    updateDialogue();
                }
            });
            
            // 关闭菜单当点击其他地方
            document.addEventListener("click", (e) => {
                if (!domElements.menuBtn.contains(e.target) && !domElements.menuModal.contains(e.target)) {
                    domElements.menuModal.style.display = "none";
                }
            });
            
            // 初始化弹窗事件
            initModals();
            
              // 设置默认立绘
            domElements.characterImg.src = GameData.currentState.characterImage;
        }
        
        // 初始化弹窗事件
        function initModals() {
            // 存档弹窗
            const cancelSaveBtn = document.getElementById("cancel-save");
            const confirmSaveBtn = document.getElementById("confirm-save");
            
            cancelSaveBtn.addEventListener("click", () => {
                domElements.saveModal.style.display = "none";
            });
            
            confirmSaveBtn.addEventListener("click", () => {
                if (selectedSaveSlot >= 0) {
                    GameData.saveToSlot(selectedSaveSlot);
                    domElements.saveModal.style.display = "none";
                    selectedSaveSlot = -1;
                    alert("存档成功！");
                } else {
                    alert("请选择一个存档位！");
                }
            });
            
            // 读档弹窗
            const cancelLoadBtn = document.getElementById("cancel-load");
            const confirmLoadBtn = document.getElementById("confirm-load");
            
            cancelLoadBtn.addEventListener("click", () => {
                domElements.loadModal.style.display = "none";
            });
            
            confirmLoadBtn.addEventListener("click", () => {
                if (selectedSaveSlot >= 0) {
                    if (GameData.loadFromSlot(selectedSaveSlot)) {
                        domElements.loadModal.style.display = "none";
                        selectedSaveSlot = -1;
                         // 恢复背景图片
                         document.querySelector('.background').style.backgroundImage = `url('${GameData.currentState.currentBackground}')`;
                        updateDialogue();
                        alert("读档成功！");
                    } else {
                        alert("该存档位为空！");
                    }
                } else {
                    alert("请选择一个存档！");
                }
            });
            
               // 重命名弹窗
            const cancelRenameBtn = document.getElementById("cancel-rename");
            const confirmRenameBtn = document.getElementById("confirm-rename");
            const newPlayerNameInput = document.getElementById("new-player-name");
            
            cancelRenameBtn.addEventListener("click", () => {
                domElements.renameModal.style.display = "none";
            });
            
            confirmRenameBtn.addEventListener("click", () => {
                const newName = newPlayerNameInput.value.trim();
                if (newName) {
                    GameData.playerName = newName;
                    domElements.renameModal.style.display = "none";
                    updateDialogue();
                    alert("名字修改成功！");
                } else {
                    alert("请输入新的角色名字！");
                }
            });
            
               
            domElements.cancelSaveNameBtn.addEventListener("click", () => {
                domElements.editSaveNameModal.style.display = "none";
            });
            
            domElements.confirmSaveNameBtn.addEventListener("click", () => {
                const newSaveName = domElements.newSaveNameInput.value.trim();
                if (newSaveName && editingSaveSlot >= 0) {
                    if (GameData.renameSaveSlot(editingSaveSlot, newSaveName)) {
                        domElements.editSaveNameModal.style.display = "none";
                        editingSaveSlot = -1;
                        
                        
                        if (domElements.saveModal.style.display === "flex") {
                            showSaveModal();
                        } else if (domElements.loadModal.style.display === "flex") {
                            showLoadModal();
                        }
                        
                        alert("存档名修改成功！");
                    } else {
                        alert("修改存档名失败！");
                    }
                } else {
                    alert("请输入有效的存档名！");
                }
            });
            }
       
  
        function showSaveModal() {
            domElements.saveModal.style.display = "flex";
            selectedSaveSlot = -1;
            
            const saveSlotsContainer = document.getElementById("save-slots");
            saveSlotsContainer.innerHTML = "";
           
            for (let i = 0; i < 10; i++) {
                const slot = document.createElement("div");
                slot.className = "save-slot";
                slot.dataset.index = i;
                
                const saveData = GameData.saveSlots[i];
                
                if (saveData) {
 
                    slot.innerHTML = `
                        <div class="save-name-edit">
                            <div class="save-name-display">${saveData.saveName}</div>
                            <button class="save-edit-btn" title="编辑存档名"><i class="fas fa-edit"></i></button>
                        </div>
                        <div class="save-time">${saveData.timestamp}</div>
                        <div class="save-content">${saveData.playerName} - ${saveData.state.branch}</div>
                    `;
                } else {
                    slot.innerHTML = `
                        <div style="font-weight: bold;">存档位 ${i + 1}</div>
                        <div class="empty-slot">空存档位</div>
                    `;
                }
                
                
              
                slot.addEventListener("click", () => {

                    document.querySelectorAll(".save-slot").forEach(s => s.classList.remove("active"));

                    slot.classList.add("active");
                    selectedSaveSlot = i;
                });
                

                const editBtn = slot.querySelector('.save-edit-btn');
                if (editBtn) {
                    editBtn.addEventListener('click', (e) => {
                        e.stopPropagation(); 
                        editingSaveSlot = i;
                        domElements.newSaveNameInput.value = GameData.saveSlots[i].saveName;
                        domElements.editSaveNameModal.style.display = "flex";
                    });
                }
                
                saveSlotsContainer.appendChild(slot);
            }
        }
        
        
        
        
        function showLoadModal() {
            domElements.loadModal.style.display = "flex";
            selectedSaveSlot = -1;
            
            const loadSlotsContainer = document.getElementById("load-slots");
            loadSlotsContainer.innerHTML = "";
            
     
            for (let i = 0; i < 10; i++) {
                const slot = document.createElement("div");
                slot.className = "save-slot";
                slot.dataset.index = i;
                
                const saveData = GameData.saveSlots[i];
                
if (saveData) {
                   
                    slot.innerHTML = `
                        <div class="save-name-edit">
                            <div class="save-name-display">${saveData.saveName}</div>
                            <button class="save-edit-btn" title="编辑存档名"><i class="fas fa-edit"></i></button>
                        </div>
                        <div class="save-time">${saveData.timestamp}</div>
                        <div class="save-content">${saveData.playerName} - ${saveData.state.branch}</div>
                    `;
                } else {
                    slot.innerHTML = `
                        <div style="font-weight: bold;">存档位 ${i + 1}</div>
                        <div class="empty-slot">空存档位</div>
                    `;
                }
                
          
                if (saveData) {
                    slot.style.cursor = "pointer";
                    slot.addEventListener("click", (e) => {
                        if (e.target.closest('.save-edit-btn')) {
                            return;
                        }
                        
                        
                        document.querySelectorAll(".save-slot").forEach(s => s.classList.remove("active"));
                        
                        slot.classList.add("active");
                        selectedSaveSlot = i;
                    });
                    
                    
                    const editBtn = slot.querySelector('.save-edit-btn');
                    if (editBtn) {
                        editBtn.addEventListener('click', (e) => {
                            e.stopPropagation(); 
                            editingSaveSlot = i;
                            domElements.newSaveNameInput.value = GameData.saveSlots[i].saveName;
                            domElements.editSaveNameModal.style.display = "flex";
                        });
                    }
                } else {
                    slot.style.cursor = "not-allowed";
                    slot.style.opacity = "0.6";
                }
                
                loadSlotsContainer.appendChild(slot);
            }
            }
                

        function showRenameModal() {
            domElements.renameModal.style.display = "flex";
            document.getElementById("new-player-name").value = GameData.playerName;
        }
        

        function updateDialogue() {
            const dialogue = GameDialogue.getCurrentDialogue();
            
            if (!dialogue) {
                GameData.currentState.branch = "start";
                GameData.currentState.dialogueIndex = 0;
                updateDialogue();
                return;
            }
            
            
            let speaker = dialogue.speaker || "";
            speaker = speaker.replace(/{PLAYER_NAME}/g, GameData.playerName);
            domElements.speakerName.textContent = speaker;

            
            let text = dialogue.text;
            text = text.replace(/{PLAYER_NAME}/g, GameData.playerName);
            domElements.dialogText.textContent = text;
            
            
       
            if (dialogue.character) {
                domElements.characterImg.src = dialogue.character;
                domElements.characterImg.classList.add("active");
                GameData.currentState.characterVisible = true;
            } else {
                domElements.characterImg.classList.remove("active");
                GameData.currentState.characterVisible = false;
            }
            
            // 更新立绘图片状态
            GameData.currentState.characterImage = dialogue.character || "";
            
            // 更新背景图片
if (dialogue.background) {
    document.querySelector('.background').style.backgroundImage = `url('${dialogue.background}')`;
    GameData.currentState.backgroundImage = dialogue.background; // 保存到状态
     GameData.currentState.currentBackground = dialogue.background; // 保存当前显示的背景
} else {
    // 如果没有指定背景，使用当前背景
    document.querySelector('.background').style.backgroundImage = `url('${GameData.currentState.currentBackground}')`;
}

            
            // 如果有选项，显示选项界面
            if (dialogue.options && dialogue.options.length > 0) {
                showOptions(dialogue.options);
            } else {
                // 隐藏选项界面
                domElements.optionsContainer.style.display = "none";
            }
        }
        
 
        function showOptions(options) {
            
            domElements.optionsContainer.style.display = "flex";
            domElements.optionTitle.textContent = "让我想想我该怎么做…";
            
          
            domElements.optionsList.innerHTML = "";
            
       
            options.forEach((option, index) => {
                const optionElement = document.createElement("div");
                optionElement.className = "option";
                optionElement.textContent = option.text.replace(/{PLAYER_NAME}/g, GameData.playerName);
                

                optionElement.addEventListener("click", () => {

                    GameDialogue.selectOption(index);
                    domElements.optionsContainer.style.display = "none";
                    updateDialogue();
                });
                
                domElements.optionsList.appendChild(optionElement);
            });
        }
    </script>
</body>
</html>